"use strict";(self.webpackChunk_law_knowledge_source=self.webpackChunk_law_knowledge_source||[]).push([[9867],{7125:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>c});var t=i(1527),a=i(6225);const s={title:"CI/CD",description:"A pipeline of CI/CD for a project",sidebar_position:2,last_update:{author:"Nguyen Xuan Nhan"}},o="CI/CD",r={id:"arch/cicd",title:"CI/CD",description:"A pipeline of CI/CD for a project",source:"@site/docs/arch/cicd.mdx",sourceDirName:"arch",slug:"/arch/cicd",permalink:"/LawKnowledge/docs/arch/cicd",draft:!1,unlisted:!1,editUrl:"https://github.com/foxminchan/LawKnowledge/tree/main/apps/docs/docs/arch/cicd.mdx",tags:[],version:"current",lastUpdatedBy:"Nguyen Xuan Nhan",lastUpdatedAt:1700680506,formattedLastUpdatedAt:"Nov 22, 2023",sidebarPosition:2,frontMatter:{title:"CI/CD",description:"A pipeline of CI/CD for a project",sidebar_position:2,last_update:{author:"Nguyen Xuan Nhan"}},sidebar:"tutorialSidebar",previous:{title:"Architecture",permalink:"/LawKnowledge/docs/arch/design"},next:{title:"Deployment",permalink:"/LawKnowledge/docs/category/deployment"}},l={},c=[{value:"Overview",id:"overview",level:2},{value:"CI/CD Pipeline",id:"cicd-pipeline",level:2},{value:"Jenkins",id:"jenkins",level:2},{value:"Installation",id:"installation",level:3},{value:"Webhook Configuration",id:"webhook-configuration",level:3},{value:"Pipeline Configuration",id:"pipeline-configuration",level:3},{value:"Pipeline Script",id:"pipeline-script",level:3},{value:"Pipeline Script for the Project",id:"pipeline-script-for-the-project",level:3},{value:"SonarQube",id:"sonarqube",level:2},{value:"Installation",id:"installation-1",level:3},{value:"Spinnaker",id:"spinnaker",level:2},{value:"Installation",id:"installation-2",level:3},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"cicd",children:"CI/CD"}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"The CI/CD pipeline is an essential part of modern software development, facilitating automated testing and deployment of code. In this project, we use Jenkins for continuous integration, SonarQube for code quality analysis, and Spinnaker for continuous deployment."})}),"\n",(0,t.jsx)(n.h2,{id:"cicd-pipeline",children:"CI/CD Pipeline"}),"\n",(0,t.jsx)("img",{loading:"lazy",src:"/LawKnowledge/img/banner/cicd.svg",alt:"CI/CD Pipeline",width:"100%"}),"\n",(0,t.jsx)(n.h2,{id:"jenkins",children:"Jenkins"}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"Jenkins is an open-source automation server that offers an easy way to set up a continuous integration and continuous delivery (CI/CD) pipeline. Continuous integration (CI) is a DevOps practice in which team members regularly commit their code changes to the version control repository, after which automated builds and tests are run. Continuous delivery (CD) is a series of practices where code changes are automatically built, tested, and deployed to production. Jenkins is the most popular open-source CI/CD tool on the market today and is used by companies large and small, including Google, Amazon, and Facebook."})}),"\n",(0,t.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"We use Jenkins as a Docker container. The following command will pull the latest Jenkins image from Docker Hub and run it on port 8080."})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run -d -p 8080:8080 -p 50000:50000 jenkins/jenkins:lts\n"})}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsxs)(n.p,{children:["After running the above command, we can access Jenkins at ",(0,t.jsx)(n.a,{href:"http://localhost:8080",children:"http://localhost:8080"}),". The first time we access Jenkins, we will be asked to enter the administrator password. We can get the password by running the following command."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker exec -it <container_id> cat /var/jenkins_home/secrets/initialAdminPassword\n"})}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"After entering the password, we will be asked to install the suggested plugins or select the plugins to install. We can select the plugins to install. After installing the plugins, we will be asked to create the first admin user. After creating the admin user, we can access Jenkins."})}),"\n",(0,t.jsx)(n.h3,{id:"webhook-configuration",children:"Webhook Configuration"}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"We need to configure the webhook for the GitHub repository. We can configure the webhook by going to the repository settings, selecting Webhooks, and clicking Add webhook. We need to enter the Payload URL, which is the URL of the Jenkins server, and the secret token. We can get the secret token by going to the Jenkins server, selecting Manage Jenkins, selecting Configure System, and scrolling down to GitHub Web Hook. We need to select the option Let Jenkins auto-manage hook URLs. We can also select the option Let Jenkins auto-manage hook URLs for jobs that use the GitSCM feature. We need to click Advanced and select the option Specify another hook secret for each job. We need to click Generate and copy the secret token. We need to paste the secret token to the GitHub repository settings."})}),"\n",(0,t.jsx)(n.h3,{id:"pipeline-configuration",children:"Pipeline Configuration"}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"We need to create a pipeline for the project. We can create a pipeline by going to the Jenkins server, selecting New Item, entering the item name, and selecting Pipeline. We need to click OK. We need to scroll down to Pipeline and select Pipeline script from SCM. We need to select Git for SCM, enter the repository URL, and enter the credentials. We need to click Save."})}),"\n",(0,t.jsx)(n.h3,{id:"pipeline-script",children:"Pipeline Script"}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"We need to create a pipeline script for the project. We can create a pipeline script by going to the Jenkins server, selecting New Item, entering the item name, and selecting Pipeline. We need to click OK. We need to scroll down to Pipeline and select Pipeline script. We need to enter the pipeline script and click Save."})}),"\n",(0,t.jsx)(n.h3,{id:"pipeline-script-for-the-project",children:"Pipeline Script for the Project"}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"We need to create a pipeline script for the project. We can create a pipeline script by going to the Jenkins server, selecting New Item, entering the item name, and selecting Pipeline. We need to click OK. We need to scroll down to Pipeline and select Pipeline script. We need to enter the pipeline script and click Save."})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jenkinsfile",children:'pipeline {\n    agent none\n    environment {\n        NX_BRANCH = env.BRANCH_NAME.replace(\'PR-\', \'\')\n    }\n    stages {\n        stage(\'Pipeline\') {\n            parallel {\n                stage(\'Main\') {\n                    when {\n                        branch \'main\'\n                    }\n                    agent any\n                    steps {\n                        sh "npm ci"\n                        sh "npx nx-cloud start-ci-run --stop-agents-after=\'build\'"\n                        sh "npx nx format:check"\n                        sh "npx nx affected --base=HEAD~1 -t lint --parallel=3 & npx nx affected --base=HEAD~1 -t test --parallel=3 --configuration=ci & npx nx affected --base=HEAD~1 -t build --parallel=3"\n                    }\n                }\n                stage(\'PR\') {\n                    when {\n                        not { branch \'main\' }\n                    }\n                    agent any\n                    steps {\n                        sh "npm ci"\n                        sh "npx nx-cloud start-ci-run --stop-agents-after=\'build\'"\n                        sh "npx nx format:check"\n                        sh "npx nx affected --base origin/${env.CHANGE_TARGET} -t lint --parallel=2 & npx nx affected --base origin/${env.CHANGE_TARGET} -t test --parallel=2 --configuration=ci & npx nx affected --base origin/${env.CHANGE_TARGET} -t build --parallel=2"\n                    }\n                }\n\n                # Add as many agent you want\n                stage(\'Agent1\') {\n                   agent any\n                   steps {\n                    sh "npm ci"\n                    sh "npx nx-cloud start-agent"\n                   }\n                }\n                stage(\'Agent2\') {\n                   agent any\n                   steps {\n                    sh "npm ci"\n                    sh "npx nx-cloud start-agent"\n                   }\n                }\n                stage(\'Agent3\') {\n                   agent any\n                   steps {\n                    sh "npm ci"\n                    sh "npx nx-cloud start-agent"\n                   }\n                }\n            }\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"sonarqube",children:"SonarQube"}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"SonarQube is an open-source platform for continuous inspection of code quality. It is used to perform automatic reviews with static analysis of code to detect bugs, code smells, and security vulnerabilities on 20+ programming languages. SonarQube offers reports on duplicated code, coding standards, unit tests, code coverage, code complexity, comments, bugs, and security vulnerabilities. SonarQube can be extended with plugins for additional languages, metrics, and integration with other development tools such as continuous integration and build systems."})}),"\n",(0,t.jsx)(n.h3,{id:"installation-1",children:"Installation"}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"We use SonarQube as a Docker container. The following command will pull the latest SonarQube image from Docker Hub and run it on port 9000."})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run -d --name sonarqube -p 9000:9000 sonarqube\n"})}),"\n",(0,t.jsx)(n.h2,{id:"spinnaker",children:"Spinnaker"}),"\n",(0,t.jsxs)("p",{align:"justify",children:[(0,t.jsx)(n.p,{children:"Spinnaker is an open-source, multi-cloud continuous delivery platform for releasing software changes with high velocity and confidence. It provides two core sets of features: cluster management and deployment management. Spinnaker\u2019s deployment management features include:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Automated Canary Deployments"}),"\n",(0,t.jsx)(n.li,{children:"Pipeline Orchestration"}),"\n",(0,t.jsx)(n.li,{children:"Stage Orchestration"}),"\n",(0,t.jsx)(n.li,{children:"Notifications"}),"\n",(0,t.jsx)(n.li,{children:"Load Balancing"}),"\n",(0,t.jsx)(n.li,{children:"Cloud Provider Integrations"}),"\n"]})]}),"\n",(0,t.jsx)(n.h3,{id:"installation-2",children:"Installation"}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"We use Spinnaker as a Helm chart. The following command will add the Spinnaker Helm chart repository."})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm repo add spinnaker https://charts.spinnaker.io/stable\n"})}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"The following command will install Spinnaker."})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm install spinnaker spinnaker/spinnaker\n"})}),"\n",(0,t.jsx)("p",{align:"justify",children:(0,t.jsx)(n.p,{children:"The following command will forward the Spinnaker UI port to port 9000."})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward svc/spin-deck 9000:9000\n"})}),"\n",(0,t.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.jenkins.io/",children:"Jenkins"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.sonarqube.org/",children:"SonarQube"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://spinnaker.io/",children:"Spinnaker"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},6225:(e,n,i)=>{i.d(n,{Z:()=>r,a:()=>o});var t=i(959);const a={},s=t.createContext(a);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);