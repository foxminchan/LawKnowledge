<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-arch/cicd" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">CI/CD | Law Knowledge</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://foxminchan.github.io/LawKnowledge/img/preview.png"><meta data-rh="true" name="twitter:image" content="https://foxminchan.github.io/LawKnowledge/img/preview.png"><meta data-rh="true" property="og:url" content="https://foxminchan.github.io/LawKnowledge/docs/arch/cicd"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="chatbot, chính phủ, pháp luật, mô hình ngôn ngữ lớn"><meta data-rh="true" name="og:title" content="Tri Thức Pháp Luật"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CI/CD | Law Knowledge"><meta data-rh="true" name="description" content="A pipeline of CI/CD for a project"><meta data-rh="true" property="og:description" content="A pipeline of CI/CD for a project"><link data-rh="true" rel="icon" href="/LawKnowledge/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://foxminchan.github.io/LawKnowledge/docs/arch/cicd"><link data-rh="true" rel="alternate" href="https://foxminchan.github.io/LawKnowledge/docs/arch/cicd" hreflang="en"><link data-rh="true" rel="alternate" href="https://foxminchan.github.io/LawKnowledge/docs/arch/cicd" hreflang="x-default"><link rel="icon" href="/LawKnowledge/img/logo.svg">
<link rel="manifest" href="/LawKnowledge/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)"><link rel="stylesheet" href="/LawKnowledge/assets/css/styles.a4dbfe04.css">
<script src="/LawKnowledge/assets/js/runtime~main.f1053e47.js" defer="defer"></script>
<script src="/LawKnowledge/assets/js/main.9534be0f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_EBPu" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_VRNx" role="banner"><div class="announcementBarPlaceholder_qXQ5"></div><div class="content_ZjQD announcementBarContent_clnV"><a target="_blank" rel="nofollow noopener noreferrer" href="https://github.com/foxminchan/LawKnowledge">⭐ Star Application on GitHub</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_BVVS announcementBarClose_eUru"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/LawKnowledge/"><div class="navbar__logo"><img src="/LawKnowledge/img/logo.svg" alt="Law Knowledge Logo" class="themedComponent_HKiH themedComponent--light_XDlR"><img src="/LawKnowledge/img/logo.svg" alt="Law Knowledge Logo" class="themedComponent_HKiH themedComponent--dark_hVLg"></div><b class="navbar__title text--truncate">Law Knowledge</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/LawKnowledge/docs/intro">Documentation</a><a href="https://www.olp.vn/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RVOB"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/foxminchan/LawKnowledge" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbarSearchContainer_gydG"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_eftb"><div class="docsWrapper_cxER"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_odVz" type="button"></button><div class="docRoot_G2oB"><aside class="theme-doc-sidebar-container docSidebarContainer_A5yO"><div class="sidebarViewport_q40c"><div class="sidebar_selP"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_sPnS menuWithAnnouncementBar_eUye"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/LawKnowledge/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/LawKnowledge/docs/start">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/LawKnowledge/docs/category/business-scenario-and-requirements">Business Scenario and Requirements</a><button aria-label="Collapse sidebar category &#x27;Business Scenario and Requirements&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/bussiness/context">Context</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/bussiness/scenario">Business Scenario</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/bussiness/story">User Stories</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/bussiness/usecase">Usecase View</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/LawKnowledge/docs/category/system-landscape">System Landscape</a><button aria-label="Collapse sidebar category &#x27;System Landscape&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/arch/design">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/LawKnowledge/docs/arch/cicd">CI/CD</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/LawKnowledge/docs/category/deployment">Deployment</a><button aria-label="Collapse sidebar category &#x27;Deployment&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/deploy/">Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/deploy/k8s">Kubernetes (Helm)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/deploy/infra">Infrastructure</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/LawKnowledge/docs/category/reference">Reference</a><button aria-label="Collapse sidebar category &#x27;Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/ref/rest">REST API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/ref/observability">Oberservability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/LawKnowledge/docs/ref/telemetry">Telemetry</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/LawKnowledge/docs/faq">FAQ&#x27;s</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/LawKnowledge/docs/sponsor">Sponsor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/LawKnowledge/docs/community">Community Support</a></li></ul></nav></div></div></aside><main class="docMainContainer_RcmZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_d4vt"><div class="docItemContainer_GjWZ"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_vyX6" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/LawKnowledge/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_HFk0"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/LawKnowledge/docs/category/system-landscape"><span itemprop="name">System Landscape</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">CI/CD</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_np_m theme-doc-toc-mobile tocMobile_JeWW"><button type="button" class="clean-btn tocCollapsibleButton_r3KE">On this page</button></div><div class="theme-doc-markdown markdown"><h1>CI/CD</h1>
<h2 class="anchor anchorWithStickyNavbar_wCdv" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p align="justify"></p><p>The CI/CD pipeline is an essential part of modern software development, facilitating automated testing and deployment of code. In this project, we use Jenkins for continuous integration, SonarQube for code quality analysis, and Spinnaker for continuous deployment.</p><p></p>
<h2 class="anchor anchorWithStickyNavbar_wCdv" id="cicd-pipeline">CI/CD Pipeline<a href="#cicd-pipeline" class="hash-link" aria-label="Direct link to CI/CD Pipeline" title="Direct link to CI/CD Pipeline">​</a></h2>
<img loading="lazy" src="/LawKnowledge/img/banner/cicd.svg" alt="CI/CD Pipeline" width="100%">
<h2 class="anchor anchorWithStickyNavbar_wCdv" id="jenkins">Jenkins<a href="#jenkins" class="hash-link" aria-label="Direct link to Jenkins" title="Direct link to Jenkins">​</a></h2>
<p align="justify"></p><p>Jenkins is an open-source automation server that offers an easy way to set up a continuous integration and continuous delivery (CI/CD) pipeline. Continuous integration (CI) is a DevOps practice in which team members regularly commit their code changes to the version control repository, after which automated builds and tests are run. Continuous delivery (CD) is a series of practices where code changes are automatically built, tested, and deployed to production. Jenkins is the most popular open-source CI/CD tool on the market today and is used by companies large and small, including Google, Amazon, and Facebook.</p><p></p>
<h3 class="anchor anchorWithStickyNavbar_wCdv" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation">​</a></h3>
<p align="justify"></p><p>We use Jenkins as a Docker container. The following command will pull the latest Jenkins image from Docker Hub and run it on port 8080.</p><p></p>
<div class="language-bash codeBlockContainer_TTmn theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_PBt0"><pre tabindex="0" class="prism-code language-bash codeBlock_QPWB thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_L8YG"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d -p 8080:8080 -p 50000:50000 jenkins/jenkins:lts</span><br></span></code></pre><div class="buttonGroup_tafg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Fk_4" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_wiVC"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ix8W"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p align="justify"></p><p>After running the above command, we can access Jenkins at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080</a>. The first time we access Jenkins, we will be asked to enter the administrator password. We can get the password by running the following command.</p><p></p>
<div class="language-bash codeBlockContainer_TTmn theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_PBt0"><pre tabindex="0" class="prism-code language-bash codeBlock_QPWB thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_L8YG"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker exec -it &lt;container_id&gt; cat /var/jenkins_home/secrets/initialAdminPassword</span><br></span></code></pre><div class="buttonGroup_tafg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Fk_4" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_wiVC"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ix8W"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p align="justify"></p><p>After entering the password, we will be asked to install the suggested plugins or select the plugins to install. We can select the plugins to install. After installing the plugins, we will be asked to create the first admin user. After creating the admin user, we can access Jenkins.</p><p></p>
<h3 class="anchor anchorWithStickyNavbar_wCdv" id="webhook-configuration">Webhook Configuration<a href="#webhook-configuration" class="hash-link" aria-label="Direct link to Webhook Configuration" title="Direct link to Webhook Configuration">​</a></h3>
<p align="justify"></p><p>We need to configure the webhook for the GitHub repository. We can configure the webhook by going to the repository settings, selecting Webhooks, and clicking Add webhook. We need to enter the Payload URL, which is the URL of the Jenkins server, and the secret token. We can get the secret token by going to the Jenkins server, selecting Manage Jenkins, selecting Configure System, and scrolling down to GitHub Web Hook. We need to select the option Let Jenkins auto-manage hook URLs. We can also select the option Let Jenkins auto-manage hook URLs for jobs that use the GitSCM feature. We need to click Advanced and select the option Specify another hook secret for each job. We need to click Generate and copy the secret token. We need to paste the secret token to the GitHub repository settings.</p><p></p>
<h3 class="anchor anchorWithStickyNavbar_wCdv" id="pipeline-configuration">Pipeline Configuration<a href="#pipeline-configuration" class="hash-link" aria-label="Direct link to Pipeline Configuration" title="Direct link to Pipeline Configuration">​</a></h3>
<p align="justify"></p><p>We need to create a pipeline for the project. We can create a pipeline by going to the Jenkins server, selecting New Item, entering the item name, and selecting Pipeline. We need to click OK. We need to scroll down to Pipeline and select Pipeline script from SCM. We need to select Git for SCM, enter the repository URL, and enter the credentials. We need to click Save.</p><p></p>
<h3 class="anchor anchorWithStickyNavbar_wCdv" id="pipeline-script">Pipeline Script<a href="#pipeline-script" class="hash-link" aria-label="Direct link to Pipeline Script" title="Direct link to Pipeline Script">​</a></h3>
<p align="justify"></p><p>We need to create a pipeline script for the project. We can create a pipeline script by going to the Jenkins server, selecting New Item, entering the item name, and selecting Pipeline. We need to click OK. We need to scroll down to Pipeline and select Pipeline script. We need to enter the pipeline script and click Save.</p><p></p>
<h3 class="anchor anchorWithStickyNavbar_wCdv" id="pipeline-script-for-the-project">Pipeline Script for the Project<a href="#pipeline-script-for-the-project" class="hash-link" aria-label="Direct link to Pipeline Script for the Project" title="Direct link to Pipeline Script for the Project">​</a></h3>
<p align="justify"></p><p>We need to create a pipeline script for the project. We can create a pipeline script by going to the Jenkins server, selecting New Item, entering the item name, and selecting Pipeline. We need to click OK. We need to scroll down to Pipeline and select Pipeline script. We need to enter the pipeline script and click Save.</p><p></p>
<div class="language-jenkinsfile codeBlockContainer_TTmn theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_PBt0"><pre tabindex="0" class="prism-code language-jenkinsfile codeBlock_QPWB thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_L8YG"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    agent none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    environment {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NX_BRANCH = env.BRANCH_NAME.replace(&#x27;PR-&#x27;, &#x27;&#x27;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    stages {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stage(&#x27;Pipeline&#x27;) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            parallel {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                stage(&#x27;Main&#x27;) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    when {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        branch &#x27;main&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    agent any</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    steps {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sh &quot;npm ci&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sh &quot;npx nx-cloud start-ci-run --stop-agents-after=&#x27;build&#x27;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sh &quot;npx nx format:check&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sh &quot;npx nx affected --base=HEAD~1 -t lint --parallel=3 &amp; npx nx affected --base=HEAD~1 -t test --parallel=3 --configuration=ci &amp; npx nx affected --base=HEAD~1 -t build --parallel=3&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                stage(&#x27;PR&#x27;) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    when {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        not { branch &#x27;main&#x27; }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    agent any</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    steps {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sh &quot;npm ci&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sh &quot;npx nx-cloud start-ci-run --stop-agents-after=&#x27;build&#x27;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sh &quot;npx nx format:check&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        sh &quot;npx nx affected --base origin/${env.CHANGE_TARGET} -t lint --parallel=2 &amp; npx nx affected --base origin/${env.CHANGE_TARGET} -t test --parallel=2 --configuration=ci &amp; npx nx affected --base origin/${env.CHANGE_TARGET} -t build --parallel=2&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                # Add as many agent you want</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                stage(&#x27;Agent1&#x27;) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   agent any</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   steps {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    sh &quot;npm ci&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    sh &quot;npx nx-cloud start-agent&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                stage(&#x27;Agent2&#x27;) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   agent any</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   steps {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    sh &quot;npm ci&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    sh &quot;npx nx-cloud start-agent&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                stage(&#x27;Agent3&#x27;) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   agent any</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   steps {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    sh &quot;npm ci&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    sh &quot;npx nx-cloud start-agent&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_tafg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Fk_4" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_wiVC"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ix8W"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_wCdv" id="sonarqube">SonarQube<a href="#sonarqube" class="hash-link" aria-label="Direct link to SonarQube" title="Direct link to SonarQube">​</a></h2>
<p align="justify"></p><p>SonarQube is an open-source platform for continuous inspection of code quality. It is used to perform automatic reviews with static analysis of code to detect bugs, code smells, and security vulnerabilities on 20+ programming languages. SonarQube offers reports on duplicated code, coding standards, unit tests, code coverage, code complexity, comments, bugs, and security vulnerabilities. SonarQube can be extended with plugins for additional languages, metrics, and integration with other development tools such as continuous integration and build systems.</p><p></p>
<h3 class="anchor anchorWithStickyNavbar_wCdv" id="installation-1">Installation<a href="#installation-1" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation">​</a></h3>
<p align="justify"></p><p>We use SonarQube as a Docker container. The following command will pull the latest SonarQube image from Docker Hub and run it on port 9000.</p><p></p>
<div class="language-bash codeBlockContainer_TTmn theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_PBt0"><pre tabindex="0" class="prism-code language-bash codeBlock_QPWB thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_L8YG"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d --name sonarqube -p 9000:9000 sonarqube</span><br></span></code></pre><div class="buttonGroup_tafg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Fk_4" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_wiVC"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ix8W"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_wCdv" id="argocd">ArgoCD<a href="#argocd" class="hash-link" aria-label="Direct link to ArgoCD" title="Direct link to ArgoCD">​</a></h2>
<p align="justify"></p><p>Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. It follows the GitOps pattern of using Git repositories as the source of truth for defining the desired application state. Kubernetes manifests can be specified in several ways: kustomize applications, ksonnet applications, helm charts, or plain directory of YAML/json manifests. Argo CD automates the deployment of the desired application states in the specified target environments. Application deployments can track updates to branches, tags, or pinned to a specific version of manifests at a Git commit. Argo CD runs a server process (<code>argocd-server</code>) which exposes both a web UI and a gRPC API (both secured via TLS). The web UI is served out of the <code>argocd-server</code> process itself. The API server is useful for automation or integrating with other tools, such as CI/CD, that need to interact with Argo CD.</p><p></p>
<h3 class="anchor anchorWithStickyNavbar_wCdv" id="installation-2">Installation<a href="#installation-2" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation">​</a></h3>
<p align="justify"></p><p>We use ArgoCD as a Docker container. The following command will pull the latest ArgoCD image from Docker Hub and run it on port 8080.</p><p></p>
<div class="language-bash codeBlockContainer_TTmn theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_PBt0"><pre tabindex="0" class="prism-code language-bash codeBlock_QPWB thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_L8YG"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d -p 8080:8080 argoproj/argocd:v2.1.2</span><br></span></code></pre><div class="buttonGroup_tafg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Fk_4" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_wiVC"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ix8W"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p align="justify"></p><p>After running the above command, we can access ArgoCD at <a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080</a>. The default username is <code>admin</code> and the default password is <code>password</code>. We can change the password by running the following command.</p><p></p>
<div class="language-bash codeBlockContainer_TTmn theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_PBt0"><pre tabindex="0" class="prism-code language-bash codeBlock_QPWB thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_L8YG"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl -n argocd patch secret argocd-secret \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -p &#x27;{&quot;stringData&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;admin.password&quot;: &quot;Hutech@123&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }}&#x27;</span><br></span></code></pre><div class="buttonGroup_tafg"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_Fk_4" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_wiVC"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Ix8W"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p align="justify"></p><p>After changing the password, we can access ArgoCD with the new password.</p><p></p>
<h3 class="anchor anchorWithStickyNavbar_wCdv" id="webhook-configuration-1">Webhook Configuration<a href="#webhook-configuration-1" class="hash-link" aria-label="Direct link to Webhook Configuration" title="Direct link to Webhook Configuration">​</a></h3>
<p align="justify"></p><p>We need to configure the webhook for the GitHub repository. We can configure the webhook by going to the repository settings, selecting Webhooks, and clicking Add webhook. We need to enter the Payload URL, which is the URL of the ArgoCD server, and the secret token. We need to click Add webhook.</p><p></p>
<h2 class="anchor anchorWithStickyNavbar_wCdv" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<ul>
<li><a href="https://www.jenkins.io/" target="_blank" rel="noopener noreferrer">Jenkins</a></li>
<li><a href="https://www.sonarqube.org/" target="_blank" rel="noopener noreferrer">SonarQube</a></li>
<li><a href="https://argoproj.github.io/argo-cd/" target="_blank" rel="noopener noreferrer">ArgoCD</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/foxminchan/LawKnowledge/tree/main/apps/docs/docs/arch/cicd.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_QL04" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_Ziz0"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-11-28T12:27:40.000Z">Nov 28, 2023</time></b> by <b>Nguyen Xuan Nhan</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/LawKnowledge/docs/arch/design"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Architecture</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/LawKnowledge/docs/category/deployment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deployment</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_SMf1 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#cicd-pipeline" class="table-of-contents__link toc-highlight">CI/CD Pipeline</a></li><li><a href="#jenkins" class="table-of-contents__link toc-highlight">Jenkins</a><ul><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#webhook-configuration" class="table-of-contents__link toc-highlight">Webhook Configuration</a></li><li><a href="#pipeline-configuration" class="table-of-contents__link toc-highlight">Pipeline Configuration</a></li><li><a href="#pipeline-script" class="table-of-contents__link toc-highlight">Pipeline Script</a></li><li><a href="#pipeline-script-for-the-project" class="table-of-contents__link toc-highlight">Pipeline Script for the Project</a></li></ul></li><li><a href="#sonarqube" class="table-of-contents__link toc-highlight">SonarQube</a><ul><li><a href="#installation-1" class="table-of-contents__link toc-highlight">Installation</a></li></ul></li><li><a href="#argocd" class="table-of-contents__link toc-highlight">ArgoCD</a><ul><li><a href="#installation-2" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#webhook-configuration-1" class="table-of-contents__link toc-highlight">Webhook Configuration</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Organization</div><ul class="footer__items clean-list"><li class="footer__item"><a href="http://olp.husc.edu.vn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OLP - HUSC<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RVOB"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://husc.hueuni.edu.vn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Hue University of Science<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RVOB"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.olp.vn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">ICPC Vietnam<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RVOB"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://vfossa.vn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vfossa<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RVOB"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                <a href="https://vfossa.vn/" target="_blank" rel="noreferrer noopener" aria-label="Vfossa">
                  <img loading="lazy" src="/LawKnowledge/img/vfossa.png" alt="Vfossa" width="150" height="55">
                </a>
              </li></ul></div><div class="col footer__col"><div class="footer__title">References</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://phapdien.moj.gov.vn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Phap dien<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RVOB"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://vbpl.vn/" target="_blank" rel="noopener noreferrer" class="footer__link-item">QPPL<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RVOB"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">ICPC</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://icpc.global" target="_blank" rel="noopener noreferrer" class="footer__link-item">Global<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RVOB"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/LawKnowledge/docs/arch/ https://icpc.iisf.or.jp/asia-pacific/">Asia Pacific</a></li><li class="footer__item"><a href="https://icpcasia.wp.txstate.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Asia<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RVOB"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/icpc.vietnam/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Fanpage<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RVOB"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.hutech.edu.vn/" rel="noopener noreferrer" class="footerLogoLink_v_I6"><img src="/LawKnowledge/img/school.png" alt="School Logo" class="footer__logo themedComponent_HKiH themedComponent--light_XDlR" width="300"><img src="/LawKnowledge/img/school.png" alt="School Logo" class="footer__logo themedComponent_HKiH themedComponent--dark_hVLg" width="300"></a></div><div class="footer__copyright">Copyright © 2023 Hutech. All rights reserved</div></div></div></footer></div>
</body>
</html>